<html>
    <link rel="stylesheet" href="stylesheet.css"> 
    


    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CSV to HTML Table</title>
        <style>
            table {
                border-collapse: collapse;
                width: 100%;
            }
            th, td {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
            }
            th {
                background-color: #f2f2f2;
            }
        </style>
    </head>

    <body>
        <h1>
            YGO Top Cut Deck Analysis
        </h1>

        <h2>
            Last updated: 10-10-24
        </h2>

        <div class="dropdowns">
            <a class="labels">Archetype:</a>
            
            <select id="archetype">

            </select>

            <a class="labels">Format:</a>

            <select id="format">
                <option value="TCG">TCG</option>
                <option value="OCG">OCG</option>
            </select>

            <a class="labels">Deck:</a>

            <select id="deck">
                <option value="main">Main</option>
                <option value="extra">Extra</option>
                <option value="side">Side</option>
            </select>

            <a class="labels">Time Frame:</a>

            <select id="timeFrame">
                <option value="31">1 Month</option>
                <option value="93">3 Month</option>
                <option value="100000">All Time</option>
            </select>
        
            <button id="fetchTable" onclick="runCode()">
                Search
            </button>

        </div>
        

        <div id="table-container" class="datatable">

        </div>
    
        <script src="script.js"></script>

        <h3>
            How to use: select parameters, press the "search" button.
        </h3>
        <h3>
            Data will be updated weekly (probably on Fridays).
        </h3>
        <h3>
            Inquries: ProjectShuckle@gmail.com
        </h3>
        <h3>
            Data source: YGOProDeck.com
        </h3>
    </body>

</html>

<script>
    async function fetchCSV(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        const text = await response.text();
        return text;
    } catch (error) {
        console.error('There was a problem with the fetch operation:', error);
    }
}

function parseCSV(text) {
    const rows = text.trim().split('\n');
    return rows.map(row => row.split('|'));
}

function createTable(data) {
    const table = document.createElement('table');
    
    data.forEach((row, index) => {
        const tr = document.createElement('tr');
        
        row.forEach(cell => {
            const td = document.createElement(index === 0 ? 'th' : 'td');
            if (cell.includes("https:")) {
                cell = '<img src="' + cell + '" class="cardImage">';
                td.innerHTML = cell;
                tr.appendChild(td);
            }
            else {
                td.textContent = cell;
                tr.appendChild(td);
            }
        });
        
        table.appendChild(tr);
    });

    return table;
}

/*-----------------test area------------------------*/
async function fetchCSV2(url) {
    const response = await fetch(url);
    if (!response.ok) {
        throw new Error('Network response was not ok');
    }
    const text = await response.text();
    return text;
}

function parseCSV2(text) {
    // Split the text by new lines and return the array
    return text.split('\n').filter(line => line.trim() !== '');
}

function populateDropdown(data) {
    const dropdown = document.getElementById('archetype');

    data.forEach(item => {
        const option = document.createElement('option');
        option.value = item;
        option.textContent = item;
        dropdown.appendChild(option);
    });
}

async function initializeDropdown() {
    const csvUrl = 'https://raw.githubusercontent.com/gregknothe/YGO-Decklist-Analytics/refs/heads/main/archetype.csv'; // Replace with the actual URL
    try {
        const csvText = await fetchCSV2(csvUrl);
        const parsedData = parseCSV2(csvText);
        populateDropdown(parsedData);
    } catch (error) {
        console.error('Error fetching or parsing CSV:', error);
    }
}

initializeDropdown();
/*-------------------------------------------------*/

async function displayCSV(url) {
    const csvText = await fetchCSV(url);
    if (csvText) {
        const parsedData = parseCSV(csvText);
        const table = createTable(parsedData);
        document.getElementById('table-container').appendChild(table);
    }
}

function removeTable(){
    //removes the current table to make space for the newly generated one.
    document.getElementById("table-container").innerHTML=""
}

//Adds listeners to all of the dropdown menus to update the table when search button is pressed.
var archetypeText = "ABC";
var formatText = "TCG";
var deckText = "main";
var timeFrameText = "31";

var csvUrl = "https://raw.githubusercontent.com/gregknothe/YGO-Decklist-Analytics/refs/heads/main/tables/" + archetypeText +"/" + formatText + "_"+ timeFrameText + "%20days_" + deckText + "_deck.csv";


var archetype = document.getElementById("archetype");
var format = document.getElementById("format");
var deck = document.getElementById("deck");
var timeFrame = document.getElementById("timeFrame");

archetype.addEventListener("change", function(){
    archetypeText = archetype.value;
    csvUrl = "https://raw.githubusercontent.com/gregknothe/YGO-Decklist-Analytics/refs/heads/main/tables/" + archetypeText +"/" + formatText + "_"+ timeFrameText + "%20days_" + deckText + "_deck.csv";
});

format.addEventListener("change", function(){
    formatText = format.value;
    csvUrl = "https://raw.githubusercontent.com/gregknothe/YGO-Decklist-Analytics/refs/heads/main/tables/" + archetypeText +"/" + formatText + "_"+ timeFrameText + "%20days_" + deckText + "_deck.csv";
});

deck.addEventListener("change", function(){
    deckText = deck.value;
    csvUrl = "https://raw.githubusercontent.com/gregknothe/YGO-Decklist-Analytics/refs/heads/main/tables/" + archetypeText +"/" + formatText + "_"+ timeFrameText + "%20days_" + deckText + "_deck.csv";
});

timeFrame.addEventListener("change", function(){
    timeFrameText = timeFrame.value;
    csvUrl = "https://raw.githubusercontent.com/gregknothe/YGO-Decklist-Analytics/refs/heads/main/tables/" + archetypeText +"/" + formatText + "_"+ timeFrameText + "%20days_" + deckText + "_deck.csv";
});

async function runCode() {
    //Updates the table.
    removeTable();
    displayCSV(csvUrl);
}

</script>

